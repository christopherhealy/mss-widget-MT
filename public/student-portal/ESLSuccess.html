<!-- /public/student-portal/ESLSuccess.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ESL Success</title>

  <!-- MSS Theme -->
  <link rel="stylesheet" href="/themes/MSSStylesheet.css" />

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --line:rgba(15,23,42,0.10);
      --soft:rgba(15,23,42,0.04);
      --brand:#0b4fd6;
      --brand2:#0f172a;
      --ok:#0a7a2f;
      --warn:#a16207;
      --bad:#b91c1c;
      --radius:14px;
    }

    body{
      background: var(--bg);
      margin:0;
      color:var(--ink);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    /* Shell */
    .wrap{ max-width: 1320px; margin: 26px auto; padding: 0 18px; }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; padding: 14px 16px;
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: 0 1px 10px rgba(0,0,0,0.05);
    }

    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 260px;
    }
    .logo{
      width:40px; height:40px; border-radius: 12px;
      background: linear-gradient(135deg, rgba(11,79,214,1), rgba(15,23,42,1));
      box-shadow: 0 10px 24px rgba(11,79,214,0.25);
    }
    .brand h1{ margin:0; font-size:18px; letter-spacing:0.2px; }
    .brand .sub{ margin:0; font-size:12px; color: var(--muted); }

    .bar-right{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end;
    }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      font-size:12px; padding: 6px 10px; border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.9);
      color: var(--muted);
      white-space: nowrap;
    }
    .pill strong{ color: var(--ink); font-weight:700; }

    .btn{
      padding: 10px 12px; border-radius: 12px;
      border:1px solid var(--line);
      background: #fff;
      cursor:pointer;
      font-weight:700;
      font-size: 13px;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      transition: transform .05s ease-out, box-shadow .08s ease-out, background .12s ease-out;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 22px rgba(15,23,42,0.08); }
    .btn.primary{ background: var(--brand); color:#fff; border-color: transparent; }
    .btn.dark{ background: var(--brand2); color:#fff; border-color: transparent; }
    .btn.ghost{ background:#fff; }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 18px;
      margin-top: 16px;
    }
    @media (max-width: 1100px){ .grid{ grid-template-columns: 1fr; } }

    /* Cards */
    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 1px 10px rgba(0,0,0,0.05);
    }
    .card h2{ margin:0 0 8px 0; font-size:16px; }
    .muted{ color: var(--muted); }
    .tiny{ font-size:12px; color: var(--muted); }
    .divider{ height:1px; background: var(--line); margin: 12px 0; }

    /* KPI row */
    .kpis{ display:grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    @media (max-width: 900px){ .kpis{ grid-template-columns: repeat(2, 1fr); } }
    .kpi{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(11,79,214,0.05), rgba(15,23,42,0.02));
      border-radius: 14px;
      padding: 12px;
      min-height: 82px;
      display:flex; flex-direction:column; justify-content:space-between;
    }
    .kpi .label{ font-size:12px; color: var(--muted); }
    .kpi .value{ font-size:22px; font-weight:800; letter-spacing: -0.2px; }
    .kpi .foot{ font-size:12px; color: var(--muted); display:flex; align-items:center; gap:8px; }
    .dot{ width:8px; height:8px; border-radius:999px; background: rgba(11,79,214,0.8); display:inline-block; }
    .dot.ok{ background: rgba(10,122,47,0.9); }
    .dot.warn{ background: rgba(161,98,7,0.9); }

    /* Student grid */
    .table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid var(--line);
    }
    .table thead th{
      text-align:left;
      font-size:12px;
      color: var(--muted);
      font-weight:800;
      padding: 10px 12px;
      background: rgba(15,23,42,0.03);
      border-bottom:1px solid var(--line);
    }
    .table tbody td{
      padding: 12px;
      border-bottom: 1px solid rgba(15,23,42,0.06);
      vertical-align: top;
      font-size: 13px;
    }
    .table tbody tr:last-child td{ border-bottom:none; }
    .table tbody tr:hover{ background: rgba(11,79,214,0.04); cursor:pointer; }
    .name{ font-weight:800; }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.9);
      color: var(--muted);
      white-space: nowrap;
    }
    .badge strong{ color: var(--ink); }
    .trend{ font-weight:900; }
    .trend.up{ color: var(--ok); }
    .trend.flat{ color: var(--muted); }
    .trend.down{ color: var(--bad); }

    .attention{
      display:inline-flex; align-items:center; gap:8px;
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(161,98,7,0.10);
      color: rgba(120, 73, 10, 1);
      border: 1px solid rgba(161,98,7,0.22);
    }
    .attention.ok{
      background: rgba(10,122,47,0.10);
      color: rgba(10,122,47,1);
      border-color: rgba(10,122,47,0.22);
    }

    /* Right panel */
    .studentHero{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .studentHero .title{ margin:0; font-size:18px; }
    .studentHero .meta{ margin:4px 0 0 0; font-size:12px; color: var(--muted); }

    .bigCEFR{
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(11,79,214,0.07), rgba(15,23,42,0.02));
      min-width: 116px;
      text-align:center;
    }
    .bigCEFR .lvl{ font-size: 22px; font-weight: 900; letter-spacing: -0.2px; }
    .bigCEFR .hint{ font-size: 12px; color: var(--muted); }

    .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top: 10px; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.95);
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }

    /* Progress placeholders */
    .sparkRow{ display:grid; grid-template-columns: 1fr; gap:10px; margin-top: 12px; }
    .spark{
      border:1px solid var(--line);
      background: rgba(15,23,42,0.02);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .spark .top{ display:flex; justify-content:space-between; gap:10px; align-items:center; }
    .spark .bar{
      height: 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.08);
      overflow:hidden;
      margin-top: 10px;
    }
    .spark .fill{
      height:100%;
      width: 62%; /* placeholder */
      background: linear-gradient(90deg, rgba(11,79,214,1), rgba(10,122,47,1));
      border-radius: 999px;
    }

    /* Notes */
    .textarea{
      width:100%;
      min-height: 110px;
      border-radius: 14px;
      border:1px solid var(--line);
      padding: 10px 12px;
      outline:none;
      resize: vertical;
      font-size: 13px;
      background:#fff;
    }

    /* AI Insight panel */
    .aiBox{
      border:1px solid rgba(11,79,214,0.28);
      background: rgba(11,79,214,0.06);
      border-radius: 14px;
      padding: 12px;
    }
    .aiBox h3{ margin:0 0 6px 0; font-size:14px; }
    .aiBox p{ margin:0; font-size:13px; color: var(--ink); line-height: 1.45; }

    /* Bottom */
    .footer{
      margin-top: 16px;
      display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
    }
    code{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- Top bar -->
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>ESL Success</h1>
          <p class="sub">Teacher workspace · progress, proof, and planning</p>
        </div>
      </div>

      <div class="bar-right">
        <span class="pill" id="pill-range"><strong>This week</strong> · Jan 26–Feb 1</span>
        <span class="pill" id="pill-teacher">Signed in: <strong id="who-email">—</strong></span>
        <span class="pill" id="pill-school">School: <strong id="pill-slug">—</strong> <span style="opacity:.7;">(id <span id="pill-schoolid">—</span>)</span></span>
        <button class="btn ghost" id="btn-refresh">Refresh</button>
        <button class="btn dark" id="btn-back">Back</button>
      </div>
    </div>

    <!-- Main grid -->
    <div class="grid">

      <!-- LEFT: KPI + Students -->
      <div>

        <!-- KPI snapshot -->
        <div class="card">
          <h2>Teacher impact snapshot</h2>
          <div class="tiny">A measurable view of engagement and progress (placeholder-ready).</div>

          <div class="kpis" style="margin-top:12px;">
            <div class="kpi">
              <div class="label">Active students</div>
              <div class="value" id="kpi-students">18</div>
              <div class="foot"><span class="dot"></span><span>+2 this month</span></div>
            </div>

            <div class="kpi">
              <div class="label">Avg CEFR</div>
              <div class="value" id="kpi-cefr">B1+</div>
              <div class="foot"><span class="dot ok"></span><span>Trend: improving</span></div>
            </div>

            <div class="kpi">
              <div class="label">Tasks completed</div>
              <div class="value" id="kpi-tasks">64</div>
              <div class="foot"><span class="dot"></span><span>Last 7 days</span></div>
            </div>

            <div class="kpi">
              <div class="label">Needs attention</div>
              <div class="value" id="kpi-attn">3</div>
              <div class="foot"><span class="dot warn"></span><span>Stalled or inactive</span></div>
            </div>
          </div>
        </div>

        <!-- Student list -->
        <div class="card" style="margin-top:16px;">
          <div style="display:flex; align-items:flex-end; justify-content:space-between; gap:12px;">
            <div>
              <h2 style="margin-bottom:4px;">Students</h2>
              <div class="tiny">Click a student to focus. (MVP: show task results from assigned tasks.)</div>
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
              <span class="pill">View: <strong>My students</strong></span>
              <button class="btn primary" id="btn-taskbuilder">Build task template</button>
            </div>
          </div>

          <div class="divider"></div>

          <table class="table" id="students-table">
            <thead>
              <tr>
                <th style="width:22%;">Student</th>
                <th style="width:12%;">CEFR</th>
                <th style="width:10%;">Trend</th>
                <th style="width:16%;">Last task</th>
                <th style="width:12%;">Avg score</th>
                <th>Signal</th>
              </tr>
            </thead>
            <tbody>
              <!-- Placeholder rows -->
              <tr data-student-id="101">
                <td>
                  <div class="name">Maria L.</div>
                  <div class="tiny">Goal: TOEFL Speaking</div>
                </td>
                <td><span class="badge"><strong>B1+</strong> <span class="muted">· stable</span></span></td>
                <td class="trend up">↑</td>
                <td>
                  <div class="tiny">Listen &amp; Repeat Set 1</div>
                  <div class="muted">2 days ago</div>
                </td>
                <td><span class="badge"><strong>22</strong> <span class="muted">TOEFL est.</span></span></td>
                <td><span class="attention ok">✓ On track</span></td>
              </tr>

              <tr data-student-id="102">
                <td>
                  <div class="name">Ahmed K.</div>
                  <div class="tiny">Goal: Workplace interviews</div>
                </td>
                <td><span class="badge"><strong>B2</strong> <span class="muted">· stable</span></span></td>
                <td class="trend flat">→</td>
                <td>
                  <div class="tiny">Interview Practice</div>
                  <div class="muted">6 days ago</div>
                </td>
                <td><span class="badge"><strong>24</strong> <span class="muted">TOEFL est.</span></span></td>
                <td><span class="attention">⚠ Fluency plateau</span></td>
              </tr>

              <tr data-student-id="103">
                <td>
                  <div class="name">Lin Z.</div>
                  <div class="tiny">Goal: University application</div>
                </td>
                <td><span class="badge"><strong>B1</strong> <span class="muted">· emerging</span></span></td>
                <td class="trend up">↑↑</td>
                <td>
                  <div class="tiny">Practice Loop (3 Qs)</div>
                  <div class="muted">Today</div>
                </td>
                <td><span class="badge"><strong>19</strong> <span class="muted">TOEFL est.</span></span></td>
                <td><span class="attention ok">✓ Big momentum</span></td>
              </tr>

              <tr data-student-id="104">
                <td>
                  <div class="name">Sofia R.</div>
                  <div class="tiny">Goal: Immigration timeline</div>
                </td>
                <td><span class="badge"><strong>A2+</strong> <span class="muted">· at risk</span></span></td>
                <td class="trend down">↓</td>
                <td>
                  <div class="tiny">Listen &amp; Repeat Set 1</div>
                  <div class="muted">12 days ago</div>
                </td>
                <td><span class="badge"><strong>15</strong> <span class="muted">TOEFL est.</span></span></td>
                <td><span class="attention">⚠ Inactive</span></td>
              </tr>
            </tbody>
          </table>

          <div class="footer">
            <div>Source of truth: assigned-task submissions (join via <code>submissions.task_id</code>).</div>
            <div class="pill">Build: <strong id="build-ts">—</strong></div>
          </div>
        </div>

      </div>

      <!-- RIGHT: Student focus -->
      <div>

        <div class="card" id="student-focus">
          <div class="studentHero">
            <div>
              <h2 class="title">Student focus</h2>
              <p class="meta">Select a student from the left. (Preview layout — MVP can show real results.)</p>
            </div>
            <div class="bigCEFR">
              <div class="lvl" id="focus-cefr">B1+</div>
              <div class="hint">Current CEFR</div>
            </div>
          </div>

          <div class="chips">
            <span class="chip">Student: <strong id="focus-name" style="color:var(--ink);">Maria L.</strong></span>
            <span class="chip">Last activity: <strong id="focus-last" style="color:var(--ink);">2 days ago</strong></span>
            <span class="chip">Avg time / week: <strong id="focus-time" style="color:var(--ink);">42 min</strong></span>
            <span class="chip">Active tasks: <strong id="focus-tasks" style="color:var(--ink);">3</strong></span>
          </div>

          <div class="divider"></div>

          <h2 style="font-size:16px;">Progress (preview)</h2>
          <div class="tiny">Simple, interpretable signals (fluency / pronunciation / grammar). Replace with real aggregates as you wire it.</div>

          <div class="sparkRow">
            <div class="spark">
              <div class="top">
                <div class="muted">Fluency</div>
                <div class="badge"><strong>3.6</strong> <span class="muted">avg</span></div>
              </div>
              <div class="bar"><div class="fill" style="width:64%"></div></div>
            </div>

            <div class="spark">
              <div class="top">
                <div class="muted">Pronunciation</div>
                <div class="badge"><strong>3.2</strong> <span class="muted">avg</span></div>
              </div>
              <div class="bar"><div class="fill" style="width:56%"></div></div>
            </div>

            <div class="spark">
              <div class="top">
                <div class="muted">Grammar</div>
                <div class="badge"><strong>3.1</strong> <span class="muted">avg</span></div>
              </div>
              <div class="bar"><div class="fill" style="width:52%"></div></div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="aiBox">
            <h3>AI Insight (preview)</h3>
            <p id="ai-insight">
              Maria’s fluency is improving faster than pronunciation. Consider short Listen &amp; Repeat tasks with reduced time pressure this week, then one interview task to transfer gains into spontaneous speech.
            </p>
            <div class="tiny" style="margin-top:8px;">
              (Later) Teacher-configurable “Learning Template” drives this analysis and lesson-plan suggestions.
            </div>
          </div>

          <div class="divider"></div>

          <h2 style="font-size:16px;">Teacher notes</h2>
          <div class="tiny">Add observations that matter (motivation, constraints, recurring issues). Used later by AI planning.</div>
          <textarea class="textarea" id="teacher-notes" placeholder="Write notes about this student… (placeholder)"></textarea>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
            <button class="btn primary" id="btn-save-notes">Save notes</button>
            <button class="btn ghost" id="btn-generate-plan">Generate lesson plan (preview)</button>
          </div>

          <div class="divider"></div>

          <h2 style="font-size:16px;">Recent evidence (assigned-task submissions)</h2>
          <div class="tiny">MVP target: this table is real, scoped to the teacher’s assigned tasks + students.</div>

          <table class="table" id="evidence-table" style="margin-top:10px;">
            <thead>
              <tr>
                <th style="width:26%;">Task</th>
                <th>Question</th>
                <th style="width:18%;">When</th>
                <th style="width:14%;">Score</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><div class="name">Listen &amp; Repeat Set 1</div><div class="tiny">task_id: 8801</div></td>
                <td class="muted">“Describe a time you solved a problem.”</td>
                <td class="muted">2026-01-29</td>
                <td><span class="badge"><strong>22</strong> <span class="muted">TOEFL</span></span></td>
              </tr>
              <tr>
                <td><div class="name">Practice Loop (3 Qs)</div><div class="tiny">task_id: 8789</div></td>
                <td class="muted">“Do you prefer to study alone or with others?”</td>
                <td class="muted">2026-01-28</td>
                <td><span class="badge"><strong>19</strong> <span class="muted">TOEFL</span></span></td>
              </tr>
            </tbody>
          </table>

          <div class="footer">
            <div id="status-right" class="tiny">Status: preview UI (wire tomorrow).</div>
            <div style="display:flex; gap:10px;">
              <button class="btn ghost" id="btn-open-dashboard">Open dashboard</button>
              <button class="btn dark" id="btn-open-submissions">Open submissions</button>
            </div>
          </div>
        </div>

      </div>

    </div><!-- /grid -->

  </div><!-- /wrap -->

  <!-- Auth client (same pattern as your other portals) -->
  <script src="/js/mss_client.js?v=2026-01-30a"></script>
  <script src="/student-portal/ESLSuccess.js?v=2026-01-30b"></script>

</body>
</html>